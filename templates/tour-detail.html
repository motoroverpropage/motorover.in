{% extends "base.html" %}

{% block head %}
  {% if tour %}
  <!-- JSON-LD Structured Data for Tour -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TouristTrip",
    "name": "{{ tour.name }}",
    "description": "{{ tour.description|default(metaDescription) }}",
    "url": "{{ url }}",
    {% if tour.image %}
    "image": "{{ tour.image }}",
    {% endif %}
    {% if tour.duration %}
    "duration": "{{ tour.duration }}",
    {% endif %}
    {% if tour.startLocation %}
    "departureLocation": {
      "@type": "Place",
      "name": "{{ tour.startLocation }}"
    },
    {% endif %}
    {% if tour.endLocation %}
    "arrivalLocation": {
      "@type": "Place",
      "name": "{{ tour.endLocation }}"
    },
    {% endif %}
    {% if tour.price %}
    "offers": {
      "@type": "Offer",
      "price": "{{ tour.price }}",
      "priceCurrency": "INR"
    },
    {% endif %}
    "provider": {
      "@type": "Organization",
      "name": "MotoRover",
      "url": "https://www.motorover.in"
    }
  }
  </script>
  {% endif %}
  
  {% if breadcrumbs %}
  <!-- BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {% for crumb in breadcrumbs %}
      {
        "@type": "ListItem",
        "position": {{ loop.index }},
        "name": "{{ crumb.name }}",
        "item": "{{ crumb.url }}"
      }{% if not loop.last %},{% endif %}
      {% endfor %}
    ]
  }
  </script>
  {% endif %}
{% endblock %}

{% block content %}
  {% if breadcrumbs %}
  <nav aria-label="Breadcrumb" class="container">
    <ol class="breadcrumbs">
      {% for crumb in breadcrumbs %}
      <li class="breadcrumbs__item">
        {% if not loop.last %}
        <a href="{{ crumb.url }}" class="breadcrumbs__link">{{ crumb.name }}</a>
        {% else %}
        <span class="breadcrumbs__current">{{ crumb.name }}</span>
        {% endif %}
      </li>
      {% endfor %}
    </ol>
  </nav>
  {% endif %}
  
  <article class="section">
    <div class="container">
      <header class="mb-12">
        <h1>{{ title }}</h1>
        {% if tour and tour.type %}
        <p style="color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; font-size: var(--font-size-sm);">
          {{ tour.type|title }} Tour
          {% if tour.duration %} â€¢ {{ tour.duration }}{% endif %}
        </p>
        {% endif %}
      </header>
      
      {% if tour and tour.gallery and tour.gallery|length > 0 %}
      <div class="gallery mb-12">
        {% for image in tour.gallery %}
        <div class="gallery__item">
          <img src="{{ image.src }}" alt="{{ image.alt|default('') }}" loading="lazy" width="{{ image.width|default(400) }}" height="{{ image.height|default(300) }}" class="gallery__image">
        </div>
        {% endfor %}
      </div>
      {% endif %}
      
      <div class="grid grid--2" style="gap: var(--space-12);">
        <div>
          {% if tour and tour.highlights %}
          <section class="mb-12">
            <h2>Highlights</h2>
            <ul>
              {% for highlight in tour.highlights %}
              <li>{{ highlight }}</li>
              {% endfor %}
            </ul>
          </section>
          {% endif %}
          
          {% if contentBlocks %}
          {% for block in contentBlocks %}
            {% if block.type == "text" %}
            <div class="mb-8">
              {{ block.content.html|safe }}
            </div>
            {% elif block.type == "itinerary" %}
            <section class="mb-12">
              <h2>Itinerary</h2>
              <div class="itinerary">
                {% for day in block.content.days|default([]) %}
                <div class="itinerary__day">
                  <h3 class="itinerary__day-title">{{ day.title|default('Day ' + loop.index) }}</h3>
                  <div class="itinerary__day-content">{{ day.content|default(day.text) }}</div>
                </div>
                {% endfor %}
              </div>
            </section>
            {% endif %}
          {% endfor %}
          {% endif %}
        </div>
        
        <aside>
          {% if tour %}
          <div class="card" style="position: sticky; top: 100px;">
            <h3 class="card__title">Tour Details</h3>
            
            {% if tour.duration %}
            <p><strong>Duration:</strong> {{ tour.duration }}</p>
            {% endif %}
            
            {% if tour.dates and tour.dates|length > 0 %}
            <div class="mb-4">
              <strong>Upcoming Dates:</strong>
              <ul>
                {% for date in tour.dates %}
                <li>{{ date }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            
            {% if tour.startLocation %}
            <p><strong>Start:</strong> {{ tour.startLocation }}</p>
            {% endif %}
            
            {% if tour.endLocation %}
            <p><strong>End:</strong> {{ tour.endLocation }}</p>
            {% endif %}
            
            {% if tour.inclusions %}
            <div class="mb-4">
              <strong>Inclusions:</strong>
              <ul>
                {% for item in tour.inclusions %}
                <li>{{ item }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            
            {% if tour.exclusions %}
            <div class="mb-4">
              <strong>Exclusions:</strong>
              <ul>
                {% for item in tour.exclusions %}
                <li>{{ item }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            
            <a href="/contact.html" class="btn btn--primary" style="width: 100%; justify-content: center; margin-top: var(--space-6);">
              Book This Tour
            </a>
          </div>
          {% endif %}
        </aside>
      </div>
    </div>
  </article>
{% endblock %}
